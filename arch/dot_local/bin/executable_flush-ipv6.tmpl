#!/bin/bash
set -o errexit
set -o nounset
set -o pipefail

# {{include ".ignore/scripts/init.sh"}}

dest=cp.cloudflare.com

if run ping -6 -c 4 $dest; then
  exit 0
fi

dev=$(
  ip route show to default |
    grep --extended-regexp --only-matching "dev [[:alnum:]]+" | sed "s/dev //"
)
run sudo ip -6 address flush dev "$dev"
run sudo rm --force --verbose /var/lib/dhclient/dhclient6.leases

sleep 5

run sudo dhclient -6 -v "$dev"

sleep 5

run sudo systemctl restart "qbittorrent-nox@$USER.service"
