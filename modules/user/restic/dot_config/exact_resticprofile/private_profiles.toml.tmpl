# -*- mode: toml; -*-
#:schema https://creativeprojects.github.io/resticprofile/jsonschema/config-1.json
# ref: <https://creativeprojects.github.io/resticprofile/reference/index.html>

[global]
initialize = true
prevent-sleep = true
# after-network-online is not available for "user_logged_on" permission schedules
schedule-defaults = { ignore-on-battery = true, permission = "user_logged_on" }
scheduler = "systemd"

[default]
# Flags used by resticprofile only:
base-dir = "{{ .chezmoi.homeDir }}"
force-inactive-lock = true
initialize = true
# Flags passed to the restic command line:
compression = "max"
password-file = "{{ .chezmoi.homeDir }}/.config/restic/password.txt"
repository = "rclone:tsinghua:restic/{{ .chezmoi.hostname }}/"
retry-lock = "5m"

[default.backup]
# Flags used by resticprofile only:
check-after = true
check-before = true
schedule = "hourly"
source = ["srv/forgejo/forgejo/git/"]
source-base = "{{ .chezmoi.homeDir }}"
source-relative = true
# Flags passed to the restic command line:
exclude = ["srv/forgejo/forgejo/git/.ssh/"]
one-file-system = true
tag = ["schedule"]

[default.forget]
# Flags used by resticprofile only:
schedule = "weekly"
# Flags passed to the restic command line:
keep-within-daily = "7d"
keep-within-hourly = "1d"
keep-within-monthly = "12m"
keep-within-weekly = "1m"
keep-within-yearly = "10y"
prune = true
repack-small = true
repack-uncompressed = true
tag = ["schedule"]
