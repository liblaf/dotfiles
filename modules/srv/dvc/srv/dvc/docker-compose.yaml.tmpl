# -*- mode: yaml; -*-
# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-go/master/schema/compose-spec.json

# ? Setting user other than root will cause permission issues.

name: DVC

services:
  dvc:
    command: >-
      serve sftp 'tsinghua:dvc' --addr ':{{ .services.dvc.port }}'
      --authorized-keys '/config/authorized_keys'
      --vfs-cache-mode full
    container_name: dvc
    image: rclone/rclone:latest
    network_mode: host # I'm too lazy to configure IPv6
    pull_policy: weekly
    restart: unless-stopped
    volumes:
      - type: bind
        source: "{{ .chezmoi.homeDir }}/.config/rclone"
        target: /config/rclone
        read_only: true
        bind:
          create_host_path: false
      - type: bind
        source: "{{ .chezmoi.homeDir }}/.ssh/authorized_keys"
        target: /config/authorized_keys
        read_only: true
        bind:
          create_host_path: false
