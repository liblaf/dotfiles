# -*- mode: yaml; -*-
# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-go/master/schema/compose-spec.json

# ref: <https://docs.linuxserver.io/general/understanding-puid-and-pgid/>
# TODO: Images from LinuxServer.io are not yet compatible with `--user` flag.

services:
  jellyfin:
    container_name: jellyfin
    environment:
      NVIDIA_VISIBLE_DEVICES: all
      PGID: "{{ .services.gid }}"
      PUID: "{{ .services.jellyfin.uid }}"
      UMASK: "002"
    image: lscr.io/linuxserver/jellyfin:latest
    ports:
      - 8096:8096/tcp
      - 8096:8096/udp
    pull_policy: weekly
    restart: unless-stopped
    runtime: nvidia
    volumes:
      - ./config:/config
      - ./fonts/fallback:/data/fonts:ro
      - ./fonts/system:/usr/local/share/fonts:ro
      - "{{ .chezmoi.homeDir }}/srv/qbittorrent/downloads:/data/qbittorrent:ro"

networks:
  default:
    enable_ipv6: true
