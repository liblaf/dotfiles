#!/bin/bash
# -*- mode: sh; -*-
set -o errexit
set -o nounset
set -o pipefail

if systemd-detect-virt; then exit; fi

packages=(
  netdata
)
yay --sync --needed --noconfirm "${packages[@]}"

sudo systemctl enable --now netdata.service

KICKSTART="/tmp/netdata-kickstart.sh"
wget --output-document="$KICKSTART" "https://get.netdata.cloud/kickstart.sh"
bash "$KICKSTART" --non-interactive --stable-channel --disable-telemetry \
  --claim-token '{{ (rbwFields "Netdata").CLAIM_TOKEN.value }}' \
  --claim-rooms '{{ (rbwFields "Netdata").ROOM_ID.value }}'
